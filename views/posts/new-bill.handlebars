<h1 style='text-align: center'>New Bill</h1>

<div class="nav">
  <ul>
    <li><a href="mycenter">My Center</a></li>
    <li><a href="new-bill">New Bill</a></li>
    <li><a href="allbills">All Bills</a></li>
      <li><p id="p_userId" style="display:none;">{{userId}}</p></li>
  </ul>
</div>
<div class="layout-border-top">
  <div class="layout-newbills">
    <div class="left-container-createInfo">
      <label class="label-info" for="new-bill-date">Date</label>
      <input class="input-info" type="date" name="user_date" id="new-bill-date" required /><br>
      <label class="label-info" for="new-bill-food">Food</label>
      <input class="input-info" type="number" name="user_food" id="new-bill-food" /><br>
      <label class="label-info" for="new-bill-entertainment">Entertainment</label>
      <input class="input-info" type="number" name="user_entertainment" id="new-bill-entertainment" /><br>
      <label class="label-info" for="new-bill-transition">Transition</label>
      <input class="input-info" type="number" name="user_transition" id="new-bill-transition" /><br>
      <label class="label-info" for="new-bill-other">Other</label>
      <input class="input-info" type="number" name="user_other" id="new-bill-other" /><br>
      <label class="label-info" for="new-bill-note">Note</label>
      <input class="input-info" type="text" name="user_note" id="new-bill-note"><br>

      <div>
        <button class="addbutton1" type="botton" id="new-bill-addbtn" @click="onCreateBill">add</button>
        <button class="addbutton2" type="submit" @click="onAddTestData"> Click To Add Test Data</button>
      </div>
    </div>

    <div>
      <div class="right-contontainer-chart">

        <div class="select-container">
          <select id="bill_option" @change="onChangeTimeFrame">

            <option value="week">LAST WEEK</option>
            <option value="month">LAST MONTH</option>
            <option value="year">LAST YEAR</option>
          </select>
          <select @change="onChangeType">
            <option value="line">LINE CHART</option>
            <option value="bar">BAR CHART</option>
            <option value="stack">STACK CHART</option>
          </select>
        </div>

        <div ref="chartContainer01" class="chartContainer01" id="chartContainer01" />


        <div id="main" class="showchart" style="width: 850px;height:450px; position:absolute"></div>
      </div>
    </div>
  </div>
</div>

<script>
(function ($) {
    debugger
    const changeTimeOption = (dateTs) => {
    const userid_form_page = $("#p_userId");
    alert(userid_form_page.html());
    const requestConfig = {
        method:'GET',
        url:'/api/bills/getBillChart',
        contentType:'application/json',
        data:{
            userId: userid_form_page.html(),
            dateTs
        }
    };
    $.ajax(requestConfig).then(res =>{
        window.chartData = res.data
        const myChart = echarts.init(document.getElementById('chartContainer01'));
        myChart.clear()
        const names = ['food', 'entertainment', 'transportation', 'other', 'total']
        const series = names.map(name => {
            console.log(name)
            const data = window.chartData.map(item => {
                return item[name]
            })
            return {
                name,
                type: 'bar',
                data
            }
        })
        const xData = window.chartData.map(item => {
            return item.date
        })
        const option = {
            title: {
                text: ''
              },
            tooltip: {},
            series,
            legend: { data: names },
            yAxis: {},
            xAxis: { data: xData }
        };
        myChart.setOption(option);
    });
  }

  changeTimeOption(Date.parse(new Date()) - 1000*60*60*24*365)
    $('#bill_option').change(function(){
        if(this.value == 'week'){
            var  dateTs = Date.parse(new Date()) - 1000*60*60*24*7;
        }else if(this.value == 'month'){
            var  dateTs = Date.parse(new Date()) - 1000*60*60*24*30;
        }else if(this.value == 'year'){
            var  dateTs = Date.parse(new Date()) - 1000*60*60*24*365;
        }
        changeTimeOption(dateTs)
  })    
})(window.jQuery)

</script> 
























{{!--
        <script type="text/javascript">
          //echarts.init(document.getElementById('main')).setOption({
          legend: { },
          tooltip: { },

          dataset: {
            // 提供一份数据。
            source: [
              ['bill', 'first day', 'second day', 'third day'],
              ['Food', 43.3, 83.8, 93.7],
              ['Entertainment', 82.1, 71.4, 55.1],
              ['Transition', 86.4, 65.2, 82.5],
              ['Other', 72.4, 53.9, 39.1]
            ]

            source: [
              ['bill', 'Food', 'Entertainment', 'Transition', 'Other'],
              ['first day', 43.3, 85.8, 93.7, 0],
              ['second day', 83.1, 73.4, 0, 55.1],
              ['third day', 86.4, 65.2, 78, 82.5],

            ]

            // 声明一个 X 轴，类目轴（category）。默认情况下，类目轴对应到 dataset 第一列。
            xAxis: { type: 'category' },
            // 声明一个 Y 轴，数值轴。
            yAxis: { },
          },
          // 声明多个 bar 系列，默认情况下，每个系列会自动对应到 dataset 的每一列。
          series: [
            { type: 'bar' },
            { type: 'bar' },
            { type: 'bar' },
            { type: 'bar' }
          ]
                });
        </script> --}}
